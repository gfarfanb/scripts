#! /usr/bin/env bash
BASEDIR=$(dirname $0); cd $BASEDIR

. ./.libs/funcs
. ./env-vars

_require_var EXECUTABLE_COMMANDS

_usage() {
    echo "Launches an executable file."
    echo ;
    echo "Usage: $0 [<option>]*"
    echo "Option:"
    echo "    -h: Displays this help message"
    exit 0
}

while getopts "h" opt; do
    case "$opt" in
        h)
            _usage
            ;;
    esac
done

_app_paths=()

for _bin in "${EXECUTABLE_COMMANDS[@]}"; do
    _app_paths+=( "$_bin" )
done

echo "Select an executable:"
for _idx in "${!_app_paths[@]}"; do
    _app="${_app_paths[$_idx]}"
    _app_name=$( cut -d : -f 1 <<< "$_app" ) 
    _app_path=$( cut -d : -f 2 <<< "$_app" )

    if [ -n "$( type -t $_app_path )" ]; then
        echo "$((_idx+1))) $_app_name [$( echo $_app_path | sed -r 's/^.+\///' )]"
    else
        echo "$((_idx+1))) (not found) $_app_name"
    fi
done
read -p "app-index> " _app_index

if [ -z "$_app_index" ]; then
    echo "Invalid app index"
    echo "[Process stopped]: $(basename $0)"
    exit 0
fi

_app="${_app_paths[$((_app_index-1))]}"
_app_path=$( cut -d : -f 2 <<< "$_app" )

if [ -z "$_app_path" ]; then
    echo "Invalid app index"
    echo "[Process stopped]: $(basename $0)"
    exit 0
fi

if [ -n "$( type -t $_app_path )" ]; then
    $_app_path
else
    _app_name=$( cut -d : -f 1 <<< "$_app" )

    echo "'$_app_name' executable not found"
    echo "[Process stopped]: $(basename $0)"
    exit 0
fi

_back

echo "[Completed]: $(basename $0)"